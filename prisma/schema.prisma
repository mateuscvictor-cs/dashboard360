generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  CS_OWNER
  CLIENT
  CLIENT_MEMBER
}

enum UserStatus {
  ONLINE
  BUSY
  OFFLINE
}

enum HealthStatus {
  CRITICAL
  RISK
  ATTENTION
  HEALTHY
}

enum CompanyProjectStatus {
  IN_PROGRESS
  PAUSED
  CONCLUDED
}

enum Priority {
  URGENT
  HIGH
  MEDIUM
  LOW
}

enum ActivityType {
  CALL
  EMAIL
  MEETING
  WHATSAPP
  NOTE
  TASK
}

enum PendingType {
  FOLLOWUP
  CHECKLIST
  DELIVERY
  NUTRITION
}

enum PendingStatus {
  PENDING
  OVERDUE
  COMPLETED
}

enum DemandType {
  SUPPORT
  ESCALATION
  REQUEST
  INTERNAL
}

enum DemandStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum DeliveryStatus {
  PENDING
  IN_PROGRESS
  BLOCKED
  COMPLETED
  DELAYED
}

enum TemplateCategory {
  DAILY
  WEEKLY
  ONBOARDING
  NUTRITION
  RESEARCH
  CUSTOM
}

enum AppliedTemplateStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

enum TimelineEventType {
  MEETING
  MESSAGE
  DELIVERY
  INCIDENT
  MILESTONE
  FEEDBACK
}

enum Sentiment {
  POSITIVE
  NEUTRAL
  NEGATIVE
}

enum EngagementLevel {
  HIGH
  MEDIUM
  LOW
  INACTIVE
}

enum AlertType {
  ACTIVITY_DROP
  DELIVERY_DELAY
  NEGATIVE_SENTIMENT
  NO_RESPONSE
  CHURN_RISK
  EXPANSION_OPPORTUNITY
}

enum ReasonType {
  RISK
  DELIVERY
  ADOPTION
  SENTIMENT
  EXPANSION
  SILENCE
}

enum InsightType {
  RECOMMENDATION
  ALERT
  OPPORTUNITY
  TREND
  WARNING
}

enum InsightStatus {
  ACTIVE
  READ
  ACTIONED
  DISMISSED
  EXPIRED
}

enum InsightScope {
  COMPANY
  CS_OWNER
  PORTFOLIO
  SQUAD
}

enum SurveyType {
  NPS
  CSAT
  ADOPTION_CHECK
}

enum SurveyStatus {
  PENDING
  COMPLETED
  EXPIRED
}

enum IPCStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum MeetingRecurrence {
  WEEKLY
  BIWEEKLY
  MONTHLY
  QUARTERLY
  CUSTOM
}

enum MeetingStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum Cadence {
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  CUSTOM
}

enum DocumentType {
  PRESENTATION
  SPREADSHEET
  PDF
  VIDEO
  IMAGE
  LINK
  OTHER
}

enum DependencyType {
  ACCESS
  DOCUMENT
  APPROVAL
  INFORMATION
}

enum DependencyStatus {
  PENDING
  PROVIDED
  OVERDUE
  NOT_NEEDED
}

enum CommentType {
  COMMENT
  CHANGE_REQUEST
  APPROVAL
  REJECTION
  RESPONSE
}

enum ClientApprovalStatus {
  PENDING_APPROVAL
  APPROVED
  CHANGES_REQUESTED
}

enum DeliveryType {
  AUTOMATION
  IPC
  MEETING
  WORKSHOP
  HOTSEAT
  OTHER
}

enum AdminApprovalStatus {
  PENDING_ADMIN_APPROVAL
  APPROVED_BY_ADMIN
  CHANGES_REQUESTED_BY_ADMIN
}

enum OnboardingStepType {
  GROUP_CREATION
  DIAGNOSTIC_FORM
  ONBOARDING_MEETING
  CUSTOM
}

enum OnboardingStepStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  SKIPPED
}

enum NotificationType {
  DEPENDENCY_ADDED
  DEPENDENCY_OVERDUE
  DELIVERY_PROGRESS
  DELIVERY_COMPLETED
  COMMENT_RESPONSE
  MEETING_SCHEDULED
  SURVEY_PENDING
  DEPENDENCY_PROVIDED
  CLIENT_COMMENT
  DELIVERY_APPROVED
  SURVEY_COMPLETED
  LOW_SCORE_ALERT
  MANUAL_MESSAGE
  BROADCAST
  DIAGNOSTIC_PENDING
  DIAGNOSTIC_COMPLETED
  COMPANY_COMMENT_MENTION
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  emailVerified DateTime?
  name          String?
  image         String?
  password      String?
  role          UserRole  @default(CLIENT)
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  notifyInApp         Boolean @default(true)
  notifyEmail         Boolean @default(true)
  notifyDeliveries    Boolean @default(true)
  notifyProgress      Boolean @default(true)
  notifyDeadlines     Boolean @default(true)
  notifyWeeklySummary Boolean @default(false)

  csOwner   CSOwner? @relation(fields: [csOwnerId], references: [id])
  csOwnerId String?  @unique

  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?

  sessions              Session[]
  accounts              Account[]
  surveyResponses       SurveyResponse[]
  sentInvites           Invite[]
  createdResources      ClientResource[]
  integrations          UserIntegration[]
  approvedDeliveries    Delivery[]        @relation("DeliveryApprovedBy")
  adminApprovedDeliveries Delivery[]      @relation("DeliveryAdminApprovedBy")
  deliveryComments      DeliveryComment[]
  companyComments       CompanyComment[]
  demandComments        DemandComment[]
  companyCommentMentions CompanyCommentMention[]  @relation("MentionedUser")
  uploadedCompanyFiles   CompanyFile[]
  receivedNotifications Notification[]    @relation("NotificationRecipient")
  sentNotifications     Notification[]    @relation("NotificationSender")
  sentDiagnostics       DiagnosticForm[]  @relation("SentDiagnostics")
  diagnosticResponses   DiagnosticResponse[]

  @@map("users")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  expires      DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  @@map("sessions")
}

model Account {
  id                String  @id @default(cuid())
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model CSOwner {
  id              String     @id @default(cuid())
  name            String
  email           String     @unique
  avatar          String?
  role            String     @default("CS Owner")
  status          UserStatus @default(OFFLINE)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  weeklyCompletion  Float @default(0)
  avgResponseTime   Float @default(0)
  npsScore          Float @default(0)
  accountsAtRisk    Int   @default(0)

  user User?

  companies           Company[]
  activities          TeamActivity[]
  pendings            Pending[]
  assignedDemands     Demand[]
  checklistItems      ChecklistItem[]
  whatsappGroups      WhatsAppGroup[]
  appliedTemplates    AppliedTemplate[]
  squadMembers        SquadMember[]
  createdWorkshops       Workshop[]
  createdHotseats        Hotseat[]
  aiInsights             AIInsight[]
  requestedSurveys       Survey[]
  deliveryCompletions    DeliveryCompletion[]
  uploadedDocuments      DeliveryDocument[]
  calendlyConfig         CalendlyConfig?
  calendlyBookings       CalendlyBooking[]
  performanceSnapshots   CSPerformanceSnapshot[]
  performanceGoals       CSPerformanceGoal[]

  @@map("cs_owners")
}

model Squad {
  id           String   @id @default(cuid())
  name         String
  capacity     Int      @default(100)
  currentLoad  Int      @default(0)
  blockedItems Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  members          SquadMember[]
  companies        Company[]
  appliedTemplates AppliedTemplate[]
  aiInsights       AIInsight[]

  @@map("squads")
}

model SquadMember {
  id       String @id @default(cuid())
  squad    Squad  @relation(fields: [squadId], references: [id], onDelete: Cascade)
  squadId  String
  csOwner  CSOwner @relation(fields: [csOwnerId], references: [id], onDelete: Cascade)
  csOwnerId String

  @@unique([squadId, csOwnerId])
  @@map("squad_members")
}

model Company {
  id              String       @id @default(cuid())
  name            String
  slug            String?      @unique
  cnpj            String?
  logo            String?
  segment         String?
  plan            String?
  billedAmount    Float        @default(0)
  cashIn          Float        @default(0)
  mrr             Float        @default(0)
  healthScore     Int          @default(100)
  healthStatus    HealthStatus @default(HEALTHY)
  riskScore       Int          @default(0)
  expansionScore  Int          @default(0)
  adoptionScore   Int          @default(0)
  lastInteraction DateTime?
  nextDelivery    DateTime?
  tags            String[]     @default([])
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  framework          String?
  workshopsCount     Int      @default(0)
  hotseatsCount      Int      @default(0)
  ipcsCount          Int      @default(0)
  meetingsCount      Int      @default(0)
  docsLink           String?
  fathomLink         String?
  contractStart      DateTime?
  contractEnd        DateTime?
  onboardingStatus   String?
  memberInviteLimit  Int      @default(0)
  projectStatus      CompanyProjectStatus?

  csOwner   CSOwner? @relation(fields: [csOwnerId], references: [id])
  csOwnerId String?

  squad   Squad?  @relation(fields: [squadId], references: [id])
  squadId String?

  users            User[]
  contacts         Contact[]
  timelineEvents   TimelineEvent[]
  deliveries       Delivery[]
  usageDataPoints  UsageDataPoint[]
  activities       TeamActivity[]
  pendings         Pending[]
  demands          Demand[]
  whatsappGroups   WhatsAppGroup[]
  priorityItems    PriorityItem[]
  aiInsights       AIInsight[]
  alerts           Alert[]
  workshops        Workshop[]
  hotseats         Hotseat[]
  ipcs             IPC[]
  meetings         Meeting[]
  surveys          Survey[]
  invites          Invite[]
  clientResources  ClientResource[]
  calendlyBookings CalendlyBooking[]
  notifications    Notification[]
  onboardingSteps  OnboardingStep[]
  diagnosticForms  DiagnosticForm[]
  meetingRecords   MeetingRecord[]
  companyComments  CompanyComment[]
  companyFiles     CompanyFile[]

  @@map("companies")
}

model CompanyFile {
  id           String   @id @default(cuid())
  name         String
  key          String
  url          String
  size         Int?
  mimeType     String?
  createdAt    DateTime @default(now())

  company      Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId    String

  uploadedBy   User?   @relation(fields: [uploadedById], references: [id])
  uploadedById String?

  @@index([companyId])
  @@map("company_files")
}

model CompanyComment {
  id          String   @id @default(cuid())
  content     String   @db.Text
  attachments Json?    @default("[]")
  createdAt   DateTime @default(now())

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  author   User   @relation(fields: [authorId], references: [id])
  authorId String

  mentions CompanyCommentMention[]

  @@index([companyId])
  @@map("company_comments")
}

model CompanyCommentMention {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  comment   CompanyComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  commentId String

  mentionedUser   User   @relation("MentionedUser", fields: [mentionedUserId], references: [id], onDelete: Cascade)
  mentionedUserId String

  @@unique([commentId, mentionedUserId])
  @@index([mentionedUserId])
  @@map("company_comment_mentions")
}

enum EventLocationType {
  ONLINE
  PRESENCIAL
}

model Workshop {
  id            String            @id @default(cuid())
  title         String
  description   String?
  date          DateTime?
  duration      Int?
  participants  Int               @default(0)
  locationType  EventLocationType @default(ONLINE)
  address       String?
  meetingLink   String?
  fathomLink    String?
  attachments   String[]          @default([])
  notes         String?
  cadence       Cadence?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  createdBy   CSOwner? @relation(fields: [createdById], references: [id])
  createdById String?

  surveys Survey[]

  @@map("workshops")
}

model Hotseat {
  id            String            @id @default(cuid())
  title         String
  description   String?
  date          DateTime
  duration      Int?
  participants  Int               @default(0)
  locationType  EventLocationType @default(ONLINE)
  address       String?
  meetingLink   String?
  fathomLink    String?
  attachments   String[]          @default([])
  notes         String?
  cadence       Cadence?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  createdBy   CSOwner? @relation(fields: [createdById], references: [id])
  createdById String?

  @@map("hotseats")
}

model Contact {
  id              String          @id @default(cuid())
  name            String
  role            String?
  email           String
  phone           String?
  isDecisionMaker Boolean         @default(false)
  engagementLevel EngagementLevel @default(MEDIUM)
  lastContact     DateTime?
  avatar          String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  meetingParticipations DeliveryMeetingParticipant[]

  @@map("contacts")
}

model TimelineEvent {
  id           String            @id @default(cuid())
  type         TimelineEventType
  title        String
  description  String?
  date         DateTime
  sentiment    Sentiment?
  participants String[]          @default([])
  metadata     Json?
  createdAt    DateTime          @default(now())

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  @@map("timeline_events")
}

model OnboardingStep {
  id          String               @id @default(cuid())
  type        OnboardingStepType
  title       String
  description String?
  status      OnboardingStepStatus @default(PENDING)
  order       Int
  completedAt DateTime?
  dueDate     DateTime?
  metadata    Json?
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  @@map("onboarding_steps")
}

model Delivery {
  id                   String               @id @default(cuid())
  title                String
  description          String?
  impactDescription    String?
  type                 DeliveryType?
  typeOtherSpec        String?
  status               DeliveryStatus       @default(PENDING)
  progress             Int                  @default(0)
  dueDate              DateTime?
  assignee             String?
  blockers             String[]             @default([])
  impact               Priority             @default(MEDIUM)
  cadence              Cadence?
  clientApprovalStatus ClientApprovalStatus?
  clientApprovedAt     DateTime?
  adminApprovalStatus  AdminApprovalStatus?
  adminApprovedAt      DateTime?
  adminScore           Float?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  clientApprovedBy   User?   @relation("DeliveryApprovedBy", fields: [clientApprovedById], references: [id])
  clientApprovedById String?
  adminApprovedBy    User?   @relation("DeliveryAdminApprovedBy", fields: [adminApprovedById], references: [id])
  adminApprovedById  String?

  surveys          Survey[]
  completion       DeliveryCompletion?
  meetings         DeliveryMeeting[]
  documents        DeliveryDocument[]
  calendlyBookings CalendlyBooking[]
  dependencies     DeliveryDependency[]
  comments         DeliveryComment[]
  notifications    Notification[]

  @@map("deliveries")
}

model UsageDataPoint {
  id          String   @id @default(cuid())
  date        DateTime
  activeUsers Int      @default(0)
  sessions    Int      @default(0)
  features    Json     @default("{}")
  createdAt   DateTime @default(now())

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  @@map("usage_data_points")
}

model TeamActivity {
  id          String       @id @default(cuid())
  type        ActivityType
  description String
  timestamp   DateTime     @default(now())
  duration    Int?
  outcome     String?
  createdAt   DateTime     @default(now())

  csOwner   CSOwner @relation(fields: [csOwnerId], references: [id], onDelete: Cascade)
  csOwnerId String

  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?

  @@map("team_activities")
}

model Pending {
  id        String        @id @default(cuid())
  type      PendingType
  title     String
  dueDate   DateTime
  priority  Priority      @default(MEDIUM)
  status    PendingStatus @default(PENDING)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  csOwner   CSOwner @relation(fields: [csOwnerId], references: [id], onDelete: Cascade)
  csOwnerId String

  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?

  @@map("pendings")
}

model Demand {
  id          String       @id @default(cuid())
  title       String
  description String?
  type        DemandType   @default(REQUEST)
  priority    Priority     @default(MEDIUM)
  status      DemandStatus @default(OPEN)
  dueDate     DateTime?
  createdBy   String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  contextExcerpt String?   @db.Text
  sourceBookingId String?

  assignedTo   CSOwner? @relation(fields: [assignedToId], references: [id])
  assignedToId String?

  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?

  sourceBooking   CalendlyBooking? @relation(fields: [sourceBookingId], references: [id])
  comments        DemandComment[]
  tasks           DemandTask[]

  @@map("demands")
}

model DemandComment {
  id          String   @id @default(cuid())
  content     String   @db.Text
  attachments Json?    @default("[]")
  createdAt   DateTime @default(now())

  demand   Demand @relation(fields: [demandId], references: [id], onDelete: Cascade)
  demandId String

  author   User   @relation(fields: [authorId], references: [id])
  authorId String

  @@index([demandId])
  @@map("demand_comments")
}

model DemandTask {
  id          String   @id @default(cuid())
  title       String
  description String?
  completed   Boolean  @default(false)
  priority    Priority @default(MEDIUM)
  orderIndex  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  demand   Demand @relation(fields: [demandId], references: [id], onDelete: Cascade)
  demandId String

  @@index([demandId])
  @@map("demand_tasks")
}

model ChecklistItem {
  id          String   @id @default(cuid())
  title       String
  description String?
  completed   Boolean  @default(false)
  priority    Priority @default(MEDIUM)
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  csOwner   CSOwner @relation(fields: [csOwnerId], references: [id], onDelete: Cascade)
  csOwnerId String

  @@map("checklist_items")
}

model WhatsAppGroup {
  id              String   @id @default(cuid())
  name            String
  lastMessage     String?
  lastMessageTime DateTime?
  unreadCount     Int      @default(0)
  members         Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  csOwner   CSOwner @relation(fields: [csOwnerId], references: [id], onDelete: Cascade)
  csOwnerId String

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  @@map("whatsapp_groups")
}

model ActivityTemplate {
  id          String           @id @default(cuid())
  name        String
  description String?
  category    TemplateCategory @default(CUSTOM)
  isDefault   Boolean          @default(false)
  createdBy   String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  tasks            TemplateTask[]
  appliedTemplates AppliedTemplate[]

  @@map("activity_templates")
}

model TemplateTask {
  id               String   @id @default(cuid())
  title            String
  description      String?
  priority         Priority @default(MEDIUM)
  estimatedMinutes Int?
  orderIndex       Int      @default(0)
  createdAt        DateTime @default(now())

  template   ActivityTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  templateId String

  @@map("template_tasks")
}

model AppliedTemplate {
  id             String                @id @default(cuid())
  dueDate        DateTime?
  status         AppliedTemplateStatus @default(ACTIVE)
  completedTasks Int                   @default(0)
  appliedBy      String?
  appliedAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt

  template   ActivityTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  templateId String

  assignedTo   CSOwner? @relation(fields: [assignedToId], references: [id])
  assignedToId String?

  assignedToSquad   Squad?  @relation(fields: [assignedToSquadId], references: [id])
  assignedToSquadId String?

  @@map("applied_templates")
}

model PriorityItem {
  id                String     @id @default(cuid())
  reason            String
  reasonType        ReasonType
  priority          Priority   @default(MEDIUM)
  recommendedAction String?
  impact            String?
  effort            Priority   @default(MEDIUM)
  dueDate           DateTime?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  @@map("priority_items")
}

model AIInsight {
  id              String        @id @default(cuid())
  insight         String
  evidence        String[]      @default([])
  source          String?
  confidence      Priority      @default(MEDIUM)
  actionSuggested String?
  expectedOutcome String?
  riskIfIgnored   String?
  type            InsightType   @default(RECOMMENDATION)
  status          InsightStatus @default(ACTIVE)
  scope           InsightScope  @default(COMPANY)
  feedback        String?
  actionTaken     Boolean       @default(false)
  expiresAt       DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @default(now()) @updatedAt

  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?

  csOwner   CSOwner? @relation(fields: [csOwnerId], references: [id])
  csOwnerId String?

  squad   Squad? @relation(fields: [squadId], references: [id])
  squadId String?

  @@map("ai_insights")
}

model Alert {
  id          String    @id @default(cuid())
  type        AlertType
  severity    Priority  @default(MEDIUM)
  title       String
  description String?
  detectedAt  DateTime  @default(now())
  action      String?
  isRead      Boolean   @default(false)
  createdAt   DateTime  @default(now())

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  @@map("alerts")
}

model IPC {
  id          String    @id @default(cuid())
  title       String
  description String?
  gptLink     String?
  status      IPCStatus @default(PENDING)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  @@map("ipcs")
}

model Meeting {
  id          String            @id @default(cuid())
  title       String
  description String?
  date        DateTime
  recurrence  MeetingRecurrence @default(MONTHLY)
  duration    Int?
  meetingLink String?
  fathomLink  String?
  notes       String?
  status      MeetingStatus     @default(SCHEDULED)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  @@map("meetings")
}

model MeetingRecord {
  id            String   @id @default(cuid())
  title         String
  date          DateTime
  transcription String   @db.Text
  summary       String?  @db.Text
  actionItems   Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  @@map("meeting_records")
}

model Survey {
  id          String       @id @default(cuid())
  type        SurveyType
  status      SurveyStatus @default(PENDING)
  aiSuggested Boolean      @default(false)
  aiReason    String?
  expiresAt   DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId String

  delivery   Delivery? @relation(fields: [deliveryId], references: [id])
  deliveryId String?

  workshop   Workshop? @relation(fields: [workshopId], references: [id])
  workshopId String?

  requestedBy CSOwner? @relation(fields: [requestedById], references: [id])
  requestedById String?

  response SurveyResponse?

  @@map("surveys")
}

model SurveyResponse {
  id String @id @default(cuid())

  npsScore          Int?
  atendimentoScore  Int?
  prazosScore       Int?
  qualidadeScore    Int?
  treinamentoScore  Int?
  clarezaScore      Int?

  csatScore Int?

  adoptionScore Int?

  comment   String?
  createdAt DateTime @default(now())

  survey   Survey @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  surveyId String @unique

  respondent   User   @relation(fields: [respondentId], references: [id])
  respondentId String

  @@map("survey_responses")
}

model DeliveryCompletion {
  id          String   @id @default(cuid())
  feedback    String
  fathomLink  String?
  completedAt DateTime @default(now())

  delivery   Delivery @relation(fields: [deliveryId], references: [id], onDelete: Cascade)
  deliveryId String   @unique

  completedBy   CSOwner @relation(fields: [completedById], references: [id])
  completedById String

  @@map("delivery_completions")
}

model DeliveryMeeting {
  id          String        @id @default(cuid())
  title       String
  description String?
  date        DateTime
  duration    Int?
  meetingLink String?
  fathomLink  String?
  notes       String?
  status      MeetingStatus @default(SCHEDULED)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  delivery   Delivery @relation(fields: [deliveryId], references: [id], onDelete: Cascade)
  deliveryId String

  participants DeliveryMeetingParticipant[]

  @@map("delivery_meetings")
}

model DeliveryMeetingParticipant {
  id       String  @id @default(cuid())
  name     String
  email    String?
  role     String?
  attended Boolean @default(false)
  createdAt DateTime @default(now())

  meeting   DeliveryMeeting @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  meetingId String

  contact   Contact? @relation(fields: [contactId], references: [id])
  contactId String?

  @@map("delivery_meeting_participants")
}

model DeliveryDocument {
  id          String       @id @default(cuid())
  title       String
  description String?
  url         String
  type        DocumentType @default(OTHER)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  delivery   Delivery @relation(fields: [deliveryId], references: [id], onDelete: Cascade)
  deliveryId String

  uploadedBy   CSOwner? @relation(fields: [uploadedById], references: [id])
  uploadedById String?

  @@map("delivery_documents")
}

model DeliveryDependency {
  id           String           @id @default(cuid())
  title        String
  description  String?
  type         DependencyType
  status       DependencyStatus @default(PENDING)
  dueDate      DateTime?
  providedAt   DateTime?
  providedNote String?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  delivery   Delivery @relation(fields: [deliveryId], references: [id], onDelete: Cascade)
  deliveryId String

  @@map("delivery_dependencies")
}

model DeliveryComment {
  id          String      @id @default(cuid())
  content     String
  type        CommentType @default(COMMENT)
  attachments Json?       @default("[]")
  createdAt   DateTime    @default(now())

  delivery   Delivery @relation(fields: [deliveryId], references: [id], onDelete: Cascade)
  deliveryId String

  author   User   @relation(fields: [authorId], references: [id])
  authorId String

  @@map("delivery_comments")
}

enum InviteType {
  COMPANY_ADMIN
  MEMBER_ADMIN
  MEMBER_CS
  COMPANY_MEMBER
}

enum InviteStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

model Invite {
  id          String       @id @default(cuid())
  email       String
  type        InviteType
  status      InviteStatus @default(PENDING)
  token       String       @unique
  expiresAt   DateTime
  createdAt   DateTime     @default(now())

  company     Company?     @relation(fields: [companyId], references: [id])
  companyId   String?

  invitedBy   User         @relation(fields: [invitedById], references: [id])
  invitedById String

  @@map("invites")
}

enum ClientResourceType {
  AUTOMATION
  IPC
  LINK
  DOCUMENT
  VIDEO
}

model ClientResource {
  id          String             @id @default(cuid())
  title       String
  description String?
  url         String?
  type        ClientResourceType
  category    String?
  icon        String?
  isActive    Boolean            @default(true)
  order       Int                @default(0)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt

  company     Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId   String

  createdBy   User?              @relation(fields: [createdById], references: [id])
  createdById String?

  @@map("client_resources")
}

enum CalendlyBookingStatus {
  PENDING
  SCHEDULED
  COMPLETED
  CANCELLED
  RESCHEDULED
  NO_SHOW
}

enum CalendlyEventType {
  ONBOARDING
  DELIVERY
  CHECKIN
  GENERAL
}

model CalendlyConfig {
  id                  String   @id @default(cuid())
  csOwnerId           String   @unique
  csOwner             CSOwner  @relation(fields: [csOwnerId], references: [id], onDelete: Cascade)
  calendlyUserUri     String?
  calendlyUsername    String
  defaultEventTypeUri String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@map("calendly_configs")
}

model CalendlyBooking {
  id                 String                @id @default(cuid())
  calendlyEventUri   String                @unique
  calendlyEventUuid  String                @unique
  eventType          CalendlyEventType     @default(GENERAL)
  eventTypeSlug      String
  title              String
  description        String?
  startTime          DateTime
  endTime            DateTime
  status             CalendlyBookingStatus @default(SCHEDULED)
  meetingUrl         String?
  csOwnerId          String
  csOwner            CSOwner               @relation(fields: [csOwnerId], references: [id], onDelete: Cascade)
  companyId          String?
  company            Company?              @relation(fields: [companyId], references: [id])
  deliveryId         String?
  delivery           Delivery?             @relation(fields: [deliveryId], references: [id])
  attendeeEmail      String
  attendeeName       String
  metadata           Json?
  notes              String?
  fathomUrl          String?
  fathomRecordingId  String?
  transcript         String?               @db.Text
  summary            String?               @db.Text
  actionItems        Json?
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt

  demands Demand[]

  @@map("calendly_bookings")
}

model UserIntegration {
  id           String   @id @default(cuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  provider     String
  encryptedKey String
  keyIv        String
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([userId, provider])
  @@map("user_integrations")
}

model Notification {
  id        String           @id @default(cuid())
  type      NotificationType
  title     String
  message   String
  link      String?
  isRead    Boolean          @default(false)
  emailSent Boolean          @default(false)
  createdAt DateTime         @default(now())

  recipient   User   @relation("NotificationRecipient", fields: [recipientId], references: [id], onDelete: Cascade)
  recipientId String

  sender   User?   @relation("NotificationSender", fields: [senderId], references: [id])
  senderId String?

  delivery   Delivery? @relation(fields: [deliveryId], references: [id])
  deliveryId String?

  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?

  @@index([recipientId, isRead])
  @@index([recipientId, createdAt])
  @@map("notifications")
}

enum EmailTemplateType {
  NOTIFICATION
  INVITE
  WELCOME
  PASSWORD_RESET
  SURVEY_REQUEST
  DELIVERY_COMPLETED
  DEPENDENCY_REMINDER
  WEEKLY_SUMMARY
}

model EmailTemplate {
  id          String            @id @default(cuid())
  type        EmailTemplateType @unique
  name        String
  subject     String
  htmlContent String            @db.Text
  variables   String[]
  isActive    Boolean           @default(true)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@map("email_templates")
}

enum DiagnosticAudience {
  ALL
  CLIENT_ONLY
  MEMBER_ONLY
}

enum DiagnosticStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  ANALYZED
  EXPIRED
}

model DiagnosticForm {
  id              String             @id @default(cuid())
  companyId       String
  company         Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  status          DiagnosticStatus   @default(PENDING)
  sentAt          DateTime           @default(now())
  sentById        String
  sentBy          User               @relation("SentDiagnostics", fields: [sentById], references: [id])
  expiresAt       DateTime?
  publicToken     String?            @unique
  targetAudience  DiagnosticAudience @default(ALL)
  notifiedAt      DateTime?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  responses   DiagnosticResponse[]
  aiAnalysis  DiagnosticAnalysis?

  @@map("diagnostic_forms")
}

model DiagnosticResponse {
  id              String          @id @default(cuid())
  diagnosticId    String
  diagnostic      DiagnosticForm  @relation(fields: [diagnosticId], references: [id], onDelete: Cascade)
  userId          String?
  user            User?           @relation(fields: [userId], references: [id])
  email           String?
  inviteSent      Boolean         @default(false)
  completedAt     DateTime?

  fullName        String
  position        String
  area            String
  timeInCompany   String
  directlyInvolved String
  directManager   String?

  topFiveTasks    String[]
  topTwoTimeTasks String[]
  copyPasteTask   String?
  reworkArea      String?
  humanErrorArea  String?
  dependencyArea  String?
  frustration     String?

  taskDetails     Json
  systemsData     Json
  priorityData    Json

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([diagnosticId, email])
  @@map("diagnostic_responses")
}

model DiagnosticAnalysis {
  id                   String          @id @default(cuid())
  diagnosticId         String          @unique
  diagnostic           DiagnosticForm  @relation(fields: [diagnosticId], references: [id], onDelete: Cascade)

  summary              String          @db.Text
  suggestedIPCs        Json?           @map("suggested_ipcs")
  suggestedAutomations Json
  priorityTasks        Json
  estimatedSavings     Json
  presentationPrompt   String?         @db.Text
  rawAnalysis          String          @db.Text

  analyzedAt           DateTime        @default(now())
  updatedAt            DateTime        @updatedAt

  @@map("diagnostic_analyses")
}

enum PerformanceMetric {
  DELIVERIES_ON_TIME
  DELIVERIES_COMPLETION
  CHECKLIST_COMPLETION
  DEMANDS_RESOLVED
  HEALTH_SCORE_AVG
  ACCOUNTS_HEALTHY
  RISK_REDUCTION
  ACTIVITIES_COUNT
  MEETINGS_COUNT
  RESPONSE_TIME
  NPS_AVERAGE
  CSAT_AVERAGE
}

enum PerformancePeriod {
  WEEKLY
  MONTHLY
  QUARTERLY
}

model CSPerformanceSnapshot {
  id        String   @id @default(cuid())
  date      DateTime @db.Date
  createdAt DateTime @default(now())

  csOwner   CSOwner @relation(fields: [csOwnerId], references: [id], onDelete: Cascade)
  csOwnerId String

  deliveriesTotal     Int   @default(0)
  deliveriesOnTime    Int   @default(0)
  deliveriesDelayed   Int   @default(0)
  deliveriesCompleted Int   @default(0)

  avgHealthScore   Float @default(0)
  accountsTotal    Int   @default(0)
  accountsAtRisk   Int   @default(0)
  accountsHealthy  Int   @default(0)
  riskReduction    Int   @default(0)

  activitiesCount     Int   @default(0)
  meetingsCount       Int   @default(0)
  checklistTotal      Int   @default(0)
  checklistCompleted  Int   @default(0)
  demandsTotal        Int   @default(0)
  demandsCompleted    Int   @default(0)

  npsAverage  Float @default(0)
  csatAverage Float @default(0)

  scoreExecution   Float @default(0)
  scorePortfolio   Float @default(0)
  scoreEngagement  Float @default(0)
  scoreSatisfaction Float @default(0)
  deliveryScoreAverage Float?
  performanceScore Float @default(0)

  ranking Int @default(0)

  @@unique([csOwnerId, date])
  @@index([date])
  @@map("cs_performance_snapshots")
}

model CSPerformanceGoal {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  csOwner   CSOwner? @relation(fields: [csOwnerId], references: [id], onDelete: Cascade)
  csOwnerId String?

  metric      PerformanceMetric
  targetValue Float
  period      PerformancePeriod
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean @default(true)

  @@index([csOwnerId])
  @@index([isActive])
  @@map("cs_performance_goals")
}
